<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CHIMERA - Unified Tracking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #F5F5F5;
            padding: env(safe-area-inset-top, 20px) 
                     env(safe-area-inset-right, 20px) 
                     env(safe-area-inset-bottom, 20px) 
                     env(safe-area-inset-left, 20px);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            width: 100%;
            max-width: 375px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: #2D5F3F;
            color: white;
            padding: 16px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .header .subtitle {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 4px;
        }
        
        /* Content */
        .content {
            padding: 20px;
        }
        
        /* Messages */
        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }
        
        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .message.show {
            display: block;
        }
        
        /* Upcoming Events Placeholder */
        .upcoming-events {
            background: #f9fafb;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            color: #9ca3af;
            font-size: 13px;
            margin-bottom: 20px;
        }
        
        /* Activity Feed */
        .activity-feed {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .activity-item {
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
            font-size: 13px;
            color: #4b5563;
            line-height: 1.5;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        /* Map Button */
        .map-btn {
            display: block;
            text-align: center;
            padding: 14px;
            background: #2D5F3F;
            color: white;
            text-decoration: none;
            font-weight: 600;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 15px;
            transition: all 0.2s;
        }
        
        .map-btn:hover {
            background: #234a31;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 95, 63, 0.3);
        }
        
        /* Instructions Box */
        .instructions {
            background: #f0f9f4;
            border: 1px solid #d1fae5;
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #065f46;
            line-height: 1.6;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
            color: #1f2937;
            background: white;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #2D5F3F;
        }
        
        /* Safety Warnings */
        .safety-container {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .safety-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .safety-icon {
            font-size: 24px;
        }
        
        .safety-title {
            font-size: 16px;
            font-weight: 700;
            color: #92400e;
        }
        
        .safety-list {
            list-style: none;
            padding: 0;
        }
        
        .safety-list li {
            padding: 6px 0;
            font-size: 14px;
            color: #78350f;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        
        .safety-list li::before {
            content: "‚Ä¢";
            font-size: 18px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .safety-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
            padding: 12px;
            background: white;
            border-radius: 8px;
        }
        
        .safety-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .safety-checkbox label {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
            cursor: pointer;
        }
        
        /* Status Display */
        .status-box {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        
        .status-label {
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .status-value {
            font-size: 18px;
            color: #1f2937;
            font-weight: 700;
        }
        
        .status-value.tracking {
            color: #2D5F3F;
        }
        
        /* Buttons */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }
        
        .btn-primary {
            background: #2D5F3F;
            color: white;
        }
        
        .btn-primary:hover {
            background: #234a31;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 95, 63, 0.3);
        }
        
        .btn-danger {
            background: #dc2626;
            color: white;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
        }
        
        .btn-secondary {
            background: white;
            color: #2D5F3F;
            border: 2px solid #2D5F3F;
        }
        
        .btn-secondary:hover {
            background: #E8F3ED;
        }
        
        .btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Photo Button */
        .photo-section {
            margin-bottom: 16px;
        }
        
        .photo-btn {
            width: 100%;
            padding: 14px;
            border: 2px dashed #d1d5db;
            background: #fafafa;
            border-radius: 8px;
            font-size: 14px;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .photo-btn:hover {
            border-color: #2D5F3F;
            background: #f5f5f5;
        }
        
        .photo-btn::before {
            content: "üì∏ ";
            font-size: 18px;
        }
        
        .photo-input {
            display: none;
        }
        
        .photo-count {
            text-align: center;
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
        }
        
        /* Checkboxes */
        .checkbox-section {
            margin-bottom: 20px;
        }
        
        .checkbox-section h3 {
            font-size: 16px;
            color: #1f2937;
            margin-bottom: 12px;
        }
        
        .checkbox-option {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .checkbox-option:hover {
            border-color: #2D5F3F;
            background: #f0f9f4;
        }
        
        .checkbox-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }
        
        .checkbox-option label {
            font-size: 15px;
            color: #1f2937;
            cursor: pointer;
            flex: 1;
        }
        
        /* Forms */
        .form-section {
            margin-bottom: 20px;
            display: none;
        }
        
        .form-section.show {
            display: block;
        }
        
        .form-section h3 {
            font-size: 16px;
            color: #1f2937;
            margin-bottom: 12px;
        }
        
        /* Scout Rating Slider */
        .rating-scale {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 12px;
            color: #6b7280;
        }
        
        .slider-container {
            position: relative;
            margin-bottom: 16px;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #4CAF50, #FF9800, #F44336);
            -webkit-appearance: none;
            appearance: none;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            border: 3px solid #2D5F3F;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            border: 3px solid #2D5F3F;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .rating-value {
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            color: #2D5F3F;
            margin-bottom: 8px;
        }
        
        .rating-description {
            text-align: center;
            font-size: 14px;
            color: #6b7280;
        }

        /* Scout Notes */
        .notes-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            color: #1f2937;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            resize: vertical;
            min-height: 80px;
            margin-top: 16px;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #2D5F3F;
        }

        .notes-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #1f2937;
            margin-top: 16px;
            margin-bottom: 8px;
        }

        .notes-helper {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .char-counter {
            font-size: 11px;
            color: #9ca3af;
            text-align: right;
            margin-top: 4px;
        }
        
        /* Collection Bags */
        .bag-entry {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .bag-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .bag-number {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .remove-bag {
            color: #dc2626;
            cursor: pointer;
            font-size: 12px;
            padding: 4px 8px;
        }
        
        .bag-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .add-bag-btn {
            width: 100%;
            padding: 10px;
            background: #f9fafb;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            color: #6b7280;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .add-bag-btn:hover {
            border-color: #2D5F3F;
            color: #2D5F3F;
        }
        
        /* Hidden class */
        .hidden {
            display: none !important;
        }
        
        /* Custom organization input */
        .custom-org-input {
            margin-top: 12px;
            display: none;
        }
        
        .custom-org-input.show {
            display: block;
        }
        
        /* Radio Consent Section */
        .consent-section {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 20px;
        }
        
        .consent-title {
            font-size: 14px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 12px;
        }
        
        .consent-question {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
        }
        
        .consent-label {
            font-size: 13px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            display: block;
        }
        
        .consent-options {
            display: flex;
            gap: 16px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .radio-option input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .radio-option label {
            font-size: 13px;
            color: #1f2937;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç CHIMERA Tracker</h1>
            <div class="subtitle">Data Hub for Litter Scouting & Collecting</div>
        </div>
        
        <div class="content">
            <!-- Message Display -->
            <div class="message" id="message"></div>
            
            <!-- SCREEN 1: Volunteer Info -->
            <div id="volunteerInfoScreen">
                <!-- Upcoming Events Placeholder -->
                <div class="upcoming-events">
                    üìÖ Upcoming Cleanups - COMING SOON
                </div>
                
                <!-- Activity Feed -->
                <div class="activity-feed" id="activityFeed">
                    <h3 style="font-size: 16px; color: #1f2937; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>üìä</span> Recent Activity
                    </h3>
                    
                    <div class="activity-stats">
                        <div class="stat-card" style="background: #f0f9f4;">
                            <div style="font-size: 24px; font-weight: 700; color: #2D5F3F;" id="sessionsToday">-</div>
                            <div style="font-size: 12px; color: #6b7280;">Recent Collections</div>
                        </div>
                        <div class="stat-card" style="background: #fef3c7;">
                            <div style="font-size: 24px; font-weight: 700; color: #92400e;" id="unvalidatedScouts">-</div>
                            <div style="font-size: 12px; color: #78350f;">Need Validation</div>
                        </div>
                    </div>
                    
                    <div class="activity-list" id="activityList" style="background: #f9fafb; border-radius: 8px; padding: 12px; max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #9ca3af; font-size: 13px; padding: 20px;">
                            Loading activity...
                        </div>
                    </div>
                </div>
                
                <!-- Map Button -->
                <a href="feb_3_fieldtest.html" class="map-btn">
                    üó∫Ô∏è View Field Test Map
                </a>
                
                <!-- Instructions -->
                <div class="instructions">
                    <strong>Getting Started:</strong><br>
                    Enter your name and organization below to begin a new scout or collection record. You will need to allow location services on your device. All GPS data are consolidated nightly and archived after 30 days. Inclusion in Activity Feed is optional.
                </div>
                
                <h2 style="font-size: 18px; margin-bottom: 16px; color: #1f2937;">Volunteer Information</h2>
                
                <div class="form-group">
                    <label class="form-label">Organization</label>
                    <select class="form-select" id="organizationSelect">
                        <option value="">Select your organization</option>
                        <option value="Baled It!">Baled It!</option>
                        <option value="Help A Brother Out Foundation">Help A Brother Out Foundation</option>
                        <option value="West Montgomery Action Committee">West Montgomery Action Committee</option>
                        <option value="other">Add organization...</option>
                    </select>
                    <div class="custom-org-input" id="customOrgInput">
                        <input type="text" class="form-input" id="customOrgText" placeholder="Enter organization name" style="margin-top: 12px;">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input type="text" class="form-input" id="volunteerName" placeholder="Enter your name">
                </div>
                
                <button class="btn btn-primary" id="continueToSafetyBtn" disabled>
                    Continue
                </button>
            </div>
            
            <!-- SCREEN 2: Safety Warnings -->
            <div id="safetyWarningsScreen" class="hidden">
                <div class="safety-container">
                    <div class="safety-header">
                        <span class="safety-icon">‚ö†Ô∏è</span>
                        <h2 class="safety-title">Safety Guidelines</h2>
                    </div>
                    
                    <ul class="safety-list">
                        <li>Watch for traffic when crossing streets</li>
                        <li>Wear gloves when handling litter</li>
                        <li>Stay hydrated and take breaks as needed</li>
                        <li>Work in pairs when possible</li>
                        <li><strong>Do NOT operate a vehicle while tracking</strong></li>
                        <li>Stay aware of your surroundings</li>
                        <li>Watch for hazards (broken glass, sharp objects, wildlife)</li>
                    </ul>
                    
                    <div class="safety-checkbox">
                        <input type="checkbox" id="safetyAcknowledge">
                        <label for="safetyAcknowledge">I understand and will follow these guidelines</label>
                    </div>
                </div>
                
                <h3 style="font-size: 16px; color: #1f2937; margin-bottom: 12px;">What would you like to do?</h3>
                
                <button class="btn btn-primary" id="scoutOnlyBtn" disabled>
                    üîç Scout: Rate Location
                </button>
                
                <button class="btn btn-primary" id="collectTrackBtn" disabled>
                    üóëÔ∏è Collect: Track Cleanup
                </button>
            </div>
            
            <!-- SCREEN 3: Scout Only (Quick Rating) -->
            <div id="scoutOnlyScreen" class="hidden">
                <div class="status-box">
                    <div class="status-row">
                        <span class="status-label">üìç Location</span>
                        <span class="status-value" id="scoutLocationStatus">Capturing...</span>
                    </div>
                </div>
                
                <h3 style="font-size: 16px; color: #1f2937; margin-bottom: 12px;">Rate This Location</h3>
                
                <div class="rating-scale">
                    <span>0 - Clean</span>
                    <span>10 - Worst Ever</span>
                </div>
                <div class="slider-container">
                    <input type="range" min="0" max="10" value="5" class="slider" id="scoutOnlyRating">
                </div>
                <div class="rating-value" id="scoutOnlyRatingValue">5</div>
                <div class="rating-description" id="scoutOnlyRatingDescription">Moderate litter density</div>
                
                <label class="notes-label">Notes (Optional)</label>
                <textarea 
                    id="scoutOnlyNotes" 
                    class="notes-textarea" 
                    maxlength="500" 
                    placeholder="Describe this location - nearby landmarks, how to find it, notable features..."></textarea>
                <div class="char-counter"><span id="scoutOnlyNotesCounter">0</span> / 500 characters</div>
                <div class="notes-helper">Help others find and validate this location</div>
                
                <!-- Scout Only Consent -->
                <div class="consent-section">
                    <div class="consent-title">üì¢ Sharing Preferences (Required)</div>
                    
                    <div class="consent-question">
                        <span class="consent-label">Include my session in the public Activity Feed?</span>
                        <div class="consent-options">
                            <div class="radio-option">
                                <input type="radio" id="scoutOnlyFeedYes" name="scoutOnlyActivityFeed" value="yes">
                                <label for="scoutOnlyFeedYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="scoutOnlyFeedNo" name="scoutOnlyActivityFeed" value="no">
                                <label for="scoutOnlyFeedNo">No</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="submitScoutOnlyBtn" disabled>
                    Submit Scout Report
                </button>
                
                <button class="btn btn-secondary" id="cancelScoutOnlyBtn">
                    Cancel
                </button>
            </div>
            
            <!-- SCREEN 4: Active Tracking (Collection) -->
            <div id="activeTrackingScreen" class="hidden">
                <div class="status-box">
                    <div class="status-row">
                        <span class="status-label">üìç Tracking</span>
                        <span class="status-value tracking">Active</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">‚è±Ô∏è Duration</span>
                        <span class="status-value" id="durationDisplay">00:00</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">üìè Distance</span>
                        <span class="status-value" id="distanceDisplay">0.00 mi</span>
                    </div>
                </div>
                
                <div class="photo-section">
                    <label for="photoInput" class="photo-btn">Take Photo</label>
                    <input type="file" id="photoInput" class="photo-input" accept="image/*" capture="environment">
                    <div class="photo-count" id="photoCount">0 photos captured</div>
                </div>
                
                <button class="btn btn-danger" id="stopTrackingBtn">
                    ‚èπÔ∏è Stop Tracking
                </button>
            </div>
            
            <!-- SCREEN 5: Post-Tracking Selection -->
            <div id="postTrackingScreen" class="hidden">
                <div class="status-box">
                    <div class="status-row">
                        <span class="status-label">Session Complete</span>
                        <span class="status-value">‚úì</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Duration</span>
                        <span class="status-value" id="finalDuration">00:00</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Distance</span>
                        <span class="status-value" id="finalDistance">0.00 mi</span>
                    </div>
                </div>
                
                <!-- Consent Section (Required Radio Buttons) -->
                <div class="consent-section">
                    <div class="consent-title">üì¢ Sharing Preferences (Required)</div>
                    
                    <div class="consent-question">
                        <span class="consent-label">Include my session in the public Activity Feed?</span>
                        <div class="consent-options">
                            <div class="radio-option">
                                <input type="radio" id="activityFeedYes" name="activityFeed" value="yes">
                                <label for="activityFeedYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="activityFeedNo" name="activityFeed" value="no">
                                <label for="activityFeedNo">No</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="consent-question" id="photoConsentQuestion" style="display: none;">
                        <span class="consent-label">My organization may use my photos for social media and promotional purposes?</span>
                        <div class="consent-options">
                            <div class="radio-option">
                                <input type="radio" id="photoConsentYes" name="photoConsent" value="yes">
                                <label for="photoConsentYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="photoConsentNo" name="photoConsent" value="no">
                                <label for="photoConsentNo">No</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="checkbox-section">
                    <h3>What did you do?</h3>
                    <div class="checkbox-option">
                        <input type="checkbox" id="scoutCheck">
                        <label for="scoutCheck">üîç Scouted (rated litter)</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="collectCheck">
                        <label for="collectCheck">üóëÔ∏è Collected (picked up litter)</label>
                    </div>
                </div>
                
                <!-- Scout Form -->
                <div class="form-section" id="scoutForm">
                    <h3>Scout Report</h3>
                    <div class="rating-scale">
                        <span>0 - Clean</span>
                        <span>10 - Worst Ever</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" min="0" max="10" value="5" class="slider" id="litterRating">
                    </div>
                    <div class="rating-value" id="ratingValue">5</div>
                    <div class="rating-description" id="ratingDescription">Moderate litter density</div>
                    
                    <label class="notes-label">Notes (Optional)</label>
                    <textarea 
                        id="scoutNotes" 
                        class="notes-textarea" 
                        maxlength="500" 
                        placeholder="Describe this location - nearby landmarks, how to find it, notable features..."></textarea>
                    <div class="char-counter"><span id="notesCounter">0</span> / 500 characters</div>
                    <div class="notes-helper">Help others find and validate this location</div>
                </div>
                
                <!-- Collection Form -->
                <div class="form-section" id="collectionForm">
                    <h3>Collection Report</h3>
                    <div id="bagsContainer"></div>
                    <button class="add-bag-btn" id="addBagBtn">+ Add Bag</button>
                </div>
                
                <button class="btn btn-primary" id="submitBtn" disabled>
                    Submit Report
                </button>
                
                <button class="btn btn-secondary" id="cancelBtn">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxyZSKDx1Z_cVeyNTQCRNqiWIhX8Caju1dUdcCLByxxIEvzDQXaYJNzcZxfW1TeTlZT/exec';
        const GPS_INTERVAL = 10000; // 10 seconds
        
        // ==========================================
        // ACTIVITY FEED
        // ==========================================
        async function loadActivityFeed() {
            try {
                const response = await fetch(APPS_SCRIPT_URL);
                const result = await response.json();
                
                if (result.status === 'success') {
                    const data = result.data;
                    
                    // Update stats
                    document.getElementById('sessionsToday').textContent = data.totalCollections;
                    document.getElementById('unvalidatedScouts').textContent = data.unvalidatedScouts;
                    
                    // Build activity list
                    const activityList = document.getElementById('activityList');
                    
                    if (data.recentActivity.length === 0) {
                        activityList.innerHTML = '<div style="text-align: center; color: #9ca3af; font-size: 13px; padding: 20px;">No recent activity</div>';
                    } else {
                        let html = '';
                        data.recentActivity.forEach(activity => {
                            const timeAgo = getTimeAgo(new Date(activity.timestamp));
                            
                            // Main collection line
                            let itemHtml = '<div class="activity-item" style="padding: 12px 0;">';
                            itemHtml += '<div style="font-weight: 600; color: #1f2937;">üóëÔ∏è ' + activity.volunteer + '</div>';
                            itemHtml += '<div style="font-size: 12px; color: #6b7280; margin-top: 2px;">';
                            itemHtml += 'collected ' + activity.weight.toFixed(1) + ' lbs';
                            if (activity.sqrtCpue) {
                                itemHtml += ' (‚àöCPUE: ' + activity.sqrtCpue.toFixed(2) + ')';
                            }
                            itemHtml += ' - ' + timeAgo + '</div>';
                            
                            // Validation substacks
                            const val = activity.validation;
                            const totalValidated = val.spotOn.length + val.under.length + val.over.length;
                            
                            if (totalValidated > 0) {
                                itemHtml += '<div style="margin-top: 8px; margin-left: 16px; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 3px solid #2D5F3F;">';
                                itemHtml += '<div style="font-size: 11px; font-weight: 700; color: #2D5F3F; margin-bottom: 6px;">üëÄ SCOUT RATINGS VALIDATED üìà</div>';
                                
                                if (val.spotOn.length > 0) {
                                    itemHtml += '<div style="font-size: 11px; color: #059669; margin-bottom: 3px;">';
                                    itemHtml += '<strong>Spot on:</strong> ' + val.spotOn.join(', ');
                                    itemHtml += '</div>';
                                }
                                
                                if (val.under.length > 0) {
                                    itemHtml += '<div style="font-size: 11px; color: #0284c7; margin-bottom: 3px;">';
                                    itemHtml += '<strong>Under:</strong> ' + val.under.join(', ');
                                    itemHtml += '</div>';
                                }
                                
                                if (val.over.length > 0) {
                                    itemHtml += '<div style="font-size: 11px; color: #dc2626;">';
                                    itemHtml += '<strong>Over:</strong> ' + val.over.join(', ');
                                    itemHtml += '</div>';
                                }
                                
                                itemHtml += '</div>';
                            } else {
                                itemHtml += '<div style="margin-top: 6px; margin-left: 16px; font-size: 11px; color: #9ca3af; font-style: italic;">No scouts validated</div>';
                            }
                            
                            itemHtml += '</div>';
                            html += itemHtml;
                        });
                        activityList.innerHTML = html;
                    }
                }
            } catch (error) {
                console.error('Activity feed error:', error);
                document.getElementById('activityList').innerHTML = '<div style="text-align: center; color: #dc2626; font-size: 13px; padding: 20px;">Failed to load activity</div>';
            }
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return 'just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' min ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' hr ago';
            if (seconds < 604800) return Math.floor(seconds / 86400) + ' days ago';
            return Math.floor(seconds / 604800) + ' weeks ago';
        }
        
        // Load activity feed when page loads
        window.addEventListener('load', loadActivityFeed);
        
        // Refresh activity feed every 60 seconds
        setInterval(loadActivityFeed, 60000);
        
        // ==========================================
        // STATE
        // ==========================================
        let sessionState = {
            sessionId: null,
            isTracking: false,
            startTime: null,
            gpsPoints: [],
            photos: [],
            totalDistance: 0,
            durationTimer: null,
            gpsTimer: null,
            organization: '',
            volunteerName: '',
            activityFeedConsent: false,
            photoConsent: false,
            mode: null // 'scout-only' or 'collect-track'
        };
        
        let bags = [];
        let bagCounter = 0;
        
        // ==========================================
        // DOM ELEMENTS
        // ==========================================
        const volunteerInfoScreen = document.getElementById('volunteerInfoScreen');
        const safetyWarningsScreen = document.getElementById('safetyWarningsScreen');
        const scoutOnlyScreen = document.getElementById('scoutOnlyScreen');
        const activeTrackingScreen = document.getElementById('activeTrackingScreen');
        const postTrackingScreen = document.getElementById('postTrackingScreen');
        
        const organizationSelect = document.getElementById('organizationSelect');
        const customOrgInput = document.getElementById('customOrgInput');
        const customOrgText = document.getElementById('customOrgText');
        const volunteerName = document.getElementById('volunteerName');
        const continueToSafetyBtn = document.getElementById('continueToSafetyBtn');
        
        const safetyAcknowledge = document.getElementById('safetyAcknowledge');
        const scoutOnlyBtn = document.getElementById('scoutOnlyBtn');
        const collectTrackBtn = document.getElementById('collectTrackBtn');
        
        const stopTrackingBtn = document.getElementById('stopTrackingBtn');
        const submitBtn = document.getElementById('submitBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        
        const durationDisplay = document.getElementById('durationDisplay');
        const distanceDisplay = document.getElementById('distanceDisplay');
        const finalDuration = document.getElementById('finalDuration');
        const finalDistance = document.getElementById('finalDistance');
        
        const photoInput = document.getElementById('photoInput');
        const photoCount = document.getElementById('photoCount');
        
        const scoutCheck = document.getElementById('scoutCheck');
        const collectCheck = document.getElementById('collectCheck');
        const scoutForm = document.getElementById('scoutForm');
        const collectionForm = document.getElementById('collectionForm');
        
        const litterRating = document.getElementById('litterRating');
        const ratingValue = document.getElementById('ratingValue');
        const ratingDescription = document.getElementById('ratingDescription');
        
        const bagsContainer = document.getElementById('bagsContainer');
        const addBagBtn = document.getElementById('addBagBtn');
        
        const messageDiv = document.getElementById('message');
        
        // Scout Only elements
        const scoutOnlyRating = document.getElementById('scoutOnlyRating');
        const scoutOnlyRatingValue = document.getElementById('scoutOnlyRatingValue');
        const scoutOnlyRatingDescription = document.getElementById('scoutOnlyRatingDescription');
        const scoutOnlyNotes = document.getElementById('scoutOnlyNotes');
        const scoutOnlyNotesCounter = document.getElementById('scoutOnlyNotesCounter');
        const submitScoutOnlyBtn = document.getElementById('submitScoutOnlyBtn');
        const cancelScoutOnlyBtn = document.getElementById('cancelScoutOnlyBtn');
        const scoutLocationStatus = document.getElementById('scoutLocationStatus');
        
        // ==========================================
        // RATING DESCRIPTIONS
        // ==========================================
        const descriptions = {
            0: 'Pristine, no visible litter',
            1: 'Very clean, minimal debris',
            2: 'Clean with occasional items',
            3: 'Light litter present',
            4: 'Noticeable litter',
            5: 'Moderate litter density',
            6: 'Heavy litter presence',
            7: 'Very heavy litter',
            8: 'Severely littered area',
            9: 'Extreme litter accumulation',
            10: 'Worst ever seen, like a landfill'
        };
        
        // ==========================================
        // UTILITIES
        // ==========================================
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = 'message show ' + type;
            setTimeout(() => messageDiv.classList.remove('show'), 5000);
        }
        
        function showScreen(screen) {
            volunteerInfoScreen.classList.add('hidden');
            safetyWarningsScreen.classList.add('hidden');
            scoutOnlyScreen.classList.add('hidden');
            activeTrackingScreen.classList.add('hidden');
            postTrackingScreen.classList.add('hidden');
            screen.classList.remove('hidden');
        }
        
        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Earth radius in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // ==========================================
        // VOLUNTEER INFO SCREEN
        // ==========================================
        organizationSelect.addEventListener('change', function() {
            if (this.value === 'other') {
                customOrgInput.classList.add('show');
                customOrgText.focus();
            } else {
                customOrgInput.classList.remove('show');
            }
            validateVolunteerInfo();
        });
        
        customOrgText.addEventListener('input', validateVolunteerInfo);
        volunteerName.addEventListener('input', validateVolunteerInfo);
        
        function validateVolunteerInfo() {
            const orgSelected = organizationSelect.value !== '';
            const orgValid = organizationSelect.value !== 'other' || customOrgText.value.trim() !== '';
            const nameValid = volunteerName.value.trim() !== '';
            
            continueToSafetyBtn.disabled = !(orgSelected && orgValid && nameValid);
        }
        
        continueToSafetyBtn.addEventListener('click', function() {
            if (organizationSelect.value === 'other') {
                sessionState.organization = customOrgText.value.trim();
            } else {
                sessionState.organization = organizationSelect.value;
            }
            sessionState.volunteerName = volunteerName.value.trim();
            
            showScreen(safetyWarningsScreen);
        });
        
        // ==========================================
        // SAFETY WARNINGS SCREEN
        // ==========================================
        safetyAcknowledge.addEventListener('change', function() {
            scoutOnlyBtn.disabled = !this.checked;
            collectTrackBtn.disabled = !this.checked;
        });
        
        // Scout Only Button
        scoutOnlyBtn.addEventListener('click', function() {
            sessionState.sessionId = generateSessionId();
            sessionState.mode = 'scout-only';
            sessionState.startTime = Date.now();
            sessionState.gpsPoints = [];
            sessionState.photos = [];
            
            showScreen(scoutOnlyScreen);
            captureScoutOnlyGPS();
        });
        
        // Collect Track Button
        collectTrackBtn.addEventListener('click', function() {
            sessionState.sessionId = generateSessionId();
            sessionState.mode = 'collect-track';
            sessionState.isTracking = true;
            sessionState.startTime = Date.now();
            sessionState.gpsPoints = [];
            sessionState.photos = [];
            sessionState.totalDistance = 0;
            
            // Capture initial GPS point
            captureGPSPoint();
            
            // Start GPS tracking
            sessionState.gpsTimer = setInterval(captureGPSPoint, GPS_INTERVAL);
            
            // Start duration timer
            sessionState.durationTimer = setInterval(updateDuration, 1000);
            
            showScreen(activeTrackingScreen);
            showMessage('Tracking started! GPS capturing every 10 seconds.', 'success');
        });
        
        // ==========================================
        // SCOUT ONLY FLOW
        // ==========================================
        function captureScoutOnlyGPS() {
            if (!navigator.geolocation) {
                showMessage('GPS not supported', 'error');
                scoutLocationStatus.textContent = 'Not Available';
                scoutLocationStatus.style.color = '#dc2626';
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const point = {
                        timestamp: new Date().toISOString(),
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };
                    sessionState.gpsPoints.push(point);
                    scoutLocationStatus.textContent = 'Captured';
                    scoutLocationStatus.style.color = '#10b981';
                },
                (error) => {
                    console.error('GPS error:', error);
                    scoutLocationStatus.textContent = 'Error';
                    scoutLocationStatus.style.color = '#dc2626';
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }
        
        scoutOnlyRating.addEventListener('input', function() {
            const value = this.value;
            scoutOnlyRatingValue.textContent = value;
            scoutOnlyRatingDescription.textContent = descriptions[value];
        });
        
        scoutOnlyNotes.addEventListener('input', function() {
            scoutOnlyNotesCounter.textContent = this.value.length;
        });
        
        // Scout Only Consent Validation
        document.querySelectorAll('input[name="scoutOnlyActivityFeed"]').forEach(radio => {
            radio.addEventListener('change', validateScoutOnlyConsent);
        });
        
        function validateScoutOnlyConsent() {
            const feedSelected = document.querySelector('input[name="scoutOnlyActivityFeed"]:checked');
            submitScoutOnlyBtn.disabled = !feedSelected;
        }
        
        submitScoutOnlyBtn.addEventListener('click', async function() {
            submitScoutOnlyBtn.disabled = true;
            submitScoutOnlyBtn.textContent = 'Submitting...';
            
            const activityFeedConsent = document.querySelector('input[name="scoutOnlyActivityFeed"]:checked').value === 'yes';
            
            const data = {
                sessionId: sessionState.sessionId,
                timestamp: new Date().toISOString(),
                organization: sessionState.organization,
                volunteerName: sessionState.volunteerName,
                gpsPoints: sessionState.gpsPoints,
                photos: [],
                duration: 0,
                distance: 0,
                activityFeedConsent: activityFeedConsent,
                photoConsent: false,
                scoutData: {
                    rating: parseInt(scoutOnlyRating.value),
                    notes: scoutOnlyNotes.value.trim() || null
                },
                collectionData: null
            };
            
            try {
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                showMessage('‚úì Scout report submitted successfully!', 'success');
                
                setTimeout(() => {
                    resetSession();
                    showScreen(volunteerInfoScreen);
                }, 2000);
                
            } catch (error) {
                console.error('Submission error:', error);
                showMessage('Submission failed. Please try again.', 'error');
                submitScoutOnlyBtn.disabled = false;
                submitScoutOnlyBtn.textContent = 'Submit Scout Report';
            }
        });
        
        cancelScoutOnlyBtn.addEventListener('click', function() {
            if (confirm('Are you sure? This will discard your scout data.')) {
                resetSession();
                showScreen(volunteerInfoScreen);
            }
        });
        
        // ==========================================
        // GPS TRACKING
        // ==========================================
        function captureGPSPoint() {
            if (!navigator.geolocation) {
                showMessage('GPS not supported', 'error');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const point = {
                        timestamp: new Date().toISOString(),
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };
                    
                    // Calculate distance
                    if (sessionState.gpsPoints.length > 0) {
                        const lastPoint = sessionState.gpsPoints[sessionState.gpsPoints.length - 1];
                        const distance = calculateDistance(
                            lastPoint.latitude,
                            lastPoint.longitude,
                            point.latitude,
                            point.longitude
                        );
                        sessionState.totalDistance += distance;
                        distanceDisplay.textContent = sessionState.totalDistance.toFixed(2) + ' mi';
                    }
                    
                    sessionState.gpsPoints.push(point);
                },
                (error) => {
                    console.error('GPS error:', error);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }
        
        function updateDuration() {
            if (!sessionState.isTracking) return;
            const elapsed = Math.floor((Date.now() - sessionState.startTime) / 1000);
            durationDisplay.textContent = formatDuration(elapsed);
        }
        
        // ==========================================
        // TRACKING CONTROLS
        // ==========================================
        stopTrackingBtn.addEventListener('click', function() {
            sessionState.isTracking = false;
            clearInterval(sessionState.gpsTimer);
            clearInterval(sessionState.durationTimer);
            
            captureGPSPoint();
            
            const totalSeconds = Math.floor((Date.now() - sessionState.startTime) / 1000);
            finalDuration.textContent = formatDuration(totalSeconds);
            finalDistance.textContent = sessionState.totalDistance.toFixed(2) + ' mi';
            
            // Show photo consent option if photos were taken
            if (sessionState.photos.length > 0) {
                document.getElementById('photoConsentQuestion').style.display = 'block';
            } else {
                document.getElementById('photoConsentQuestion').style.display = 'none';
            }
            
            showScreen(postTrackingScreen);
        });
        
        // ==========================================
        // PHOTO CAPTURE
        // ==========================================
        photoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            navigator.geolocation.getCurrentPosition((position) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const photo = {
                        timestamp: new Date().toISOString(),
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        data: event.target.result
                    };
                    sessionState.photos.push(photo);
                    photoCount.textContent = sessionState.photos.length + ' photo' + (sessionState.photos.length !== 1 ? 's' : '') + ' captured';
                    showMessage('Photo captured!', 'success');
                };
                reader.readAsDataURL(file);
            });
            
            photoInput.value = '';
        });
        
        // ==========================================
        // CHECKBOX LOGIC
        // ==========================================
        function updateFormVisibility() {
            const scoutChecked = scoutCheck.checked;
            const collectChecked = collectCheck.checked;
            
            if (scoutChecked) {
                scoutForm.classList.add('show');
            } else {
                scoutForm.classList.remove('show');
            }
            
            if (collectChecked) {
                collectionForm.classList.add('show');
                if (bags.length === 0) {
                    addBag();
                }
            } else {
                collectionForm.classList.remove('show');
            }
            
            validatePostTrackingSubmit();
        }
        
        scoutCheck.addEventListener('change', updateFormVisibility);
        collectCheck.addEventListener('change', updateFormVisibility);
        
        // ==========================================
        // POST-TRACKING CONSENT VALIDATION
        // ==========================================
        document.querySelectorAll('input[name="activityFeed"]').forEach(radio => {
            radio.addEventListener('change', validatePostTrackingSubmit);
        });
        
        document.querySelectorAll('input[name="photoConsent"]').forEach(radio => {
            radio.addEventListener('change', validatePostTrackingSubmit);
        });
        
        function validatePostTrackingSubmit() {
            const scoutChecked = scoutCheck.checked;
            const collectChecked = collectCheck.checked;
            const activityFeedSelected = document.querySelector('input[name="activityFeed"]:checked');
            const photoConsentSelected = sessionState.photos.length > 0 ? 
                document.querySelector('input[name="photoConsent"]:checked') : true;
            
            const allConsentsGiven = activityFeedSelected && photoConsentSelected;
            const activitySelected = scoutChecked || collectChecked;
            
            submitBtn.disabled = !(allConsentsGiven && activitySelected);
        }
        
        // ==========================================
        // RATING SLIDER
        // ==========================================
        litterRating.addEventListener('input', function() {
            const value = this.value;
            ratingValue.textContent = value;
            ratingDescription.textContent = descriptions[value];
        });

        // ==========================================
        // SCOUT NOTES CHARACTER COUNTER
        // ==========================================
        const scoutNotes = document.getElementById('scoutNotes');
        const notesCounter = document.getElementById('notesCounter');

        scoutNotes.addEventListener('input', function() {
            notesCounter.textContent = this.value.length;
        });
        
        // ==========================================
        // BAG MANAGEMENT
        // ==========================================
        function addBag() {
            bagCounter++;
            const bagId = 'bag_' + bagCounter;
            
            const bagDiv = document.createElement('div');
            bagDiv.className = 'bag-entry';
            bagDiv.id = bagId;
            bagDiv.innerHTML = `
                <div class="bag-header">
                    <span class="bag-number">Bag ${bagCounter}</span>
                    <span class="remove-bag" onclick="removeBag('${bagId}')">Remove</span>
                </div>
                <input type="number" class="bag-input" placeholder="Weight in lbs" step="0.1" min="0">
            `;
            
            bagsContainer.appendChild(bagDiv);
            bags.push(bagId);
        }
        
        function removeBag(bagId) {
            document.getElementById(bagId).remove();
            bags = bags.filter(id => id !== bagId);
        }
        
        addBagBtn.addEventListener('click', addBag);
        
        // ==========================================
        // SUBMISSION
        // ==========================================
        submitBtn.addEventListener('click', async function() {
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            const bagData = [];
            if (collectCheck.checked) {
                const bagInputs = bagsContainer.querySelectorAll('.bag-input');
                bagInputs.forEach(input => {
                    const weight = parseFloat(input.value) || 0;
                    if (weight > 0) {
                        bagData.push(weight);
                    }
                });
            }
            
            const totalSeconds = Math.floor((Date.now() - sessionState.startTime) / 1000);
            
            // Capture consent preferences
            const activityFeedConsent = document.querySelector('input[name="activityFeed"]:checked').value === 'yes';
            const photoConsent = sessionState.photos.length > 0 ? 
                document.querySelector('input[name="photoConsent"]:checked').value === 'yes' : false;
            
            const data = {
                sessionId: sessionState.sessionId,
                timestamp: new Date().toISOString(),
                organization: sessionState.organization,
                volunteerName: sessionState.volunteerName,
                gpsPoints: sessionState.gpsPoints,
                photos: sessionState.photos,
                duration: totalSeconds,
                distance: sessionState.totalDistance,
                activityFeedConsent: activityFeedConsent,
                photoConsent: photoConsent,
                scoutData: scoutCheck.checked ? {
                    rating: parseInt(litterRating.value),
                    notes: scoutNotes.value.trim() || null
                } : null,
                collectionData: collectCheck.checked ? {
                    bags: bagData,
                    totalWeight: bagData.reduce((sum, w) => sum + w, 0)
                } : null
            };
            
            try {
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                showMessage('‚úì Report submitted successfully!', 'success');
                
                setTimeout(() => {
                    resetSession();
                    showScreen(volunteerInfoScreen);
                }, 2000);
                
            } catch (error) {
                console.error('Submission error:', error);
                showMessage('Submission failed. Please try again.', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Report';
            }
        });
        
        cancelBtn.addEventListener('click', function() {
            if (confirm('Are you sure? This will discard your tracking data.')) {
                resetSession();
                showScreen(volunteerInfoScreen);
            }
        });
        
        function resetSession() {
            sessionState.sessionId = null;
            sessionState.isTracking = false;
            sessionState.startTime = null;
            sessionState.gpsPoints = [];
            sessionState.photos = [];
            sessionState.totalDistance = 0;
            sessionState.durationTimer = null;
            sessionState.gpsTimer = null;
            sessionState.activityFeedConsent = false;
            sessionState.photoConsent = false;
            sessionState.mode = null;
            
            scoutCheck.checked = false;
            collectCheck.checked = false;
            litterRating.value = 5;
            ratingValue.textContent = '5';
            ratingDescription.textContent = descriptions[5];
            scoutNotes.value = '';
            notesCounter.textContent = '0';
            bagsContainer.innerHTML = '';
            bags = [];
            bagCounter = 0;
            
            // Reset scout only
            scoutOnlyRating.value = 5;
            scoutOnlyRatingValue.textContent = '5';
            scoutOnlyRatingDescription.textContent = descriptions[5];
            scoutOnlyNotes.value = '';
            scoutOnlyNotesCounter.textContent = '0';
            scoutLocationStatus.textContent = 'Capturing...';
            scoutLocationStatus.style.color = '#1f2937';
            
            // Reset consents
            document.querySelectorAll('input[name="activityFeed"]').forEach(r => r.checked = false);
            document.querySelectorAll('input[name="photoConsent"]').forEach(r => r.checked = false);
            document.querySelectorAll('input[name="scoutOnlyActivityFeed"]').forEach(r => r.checked = false);
            
            document.getElementById('photoConsentQuestion').style.display = 'none';
            
            durationDisplay.textContent = '00:00';
            distanceDisplay.textContent = '0.00 mi';
            photoCount.textContent = '0 photos captured';
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submit Report';
            submitScoutOnlyBtn.disabled = true;
            submitScoutOnlyBtn.textContent = 'Submit Scout Report';
            
            updateFormVisibility();
        }
    </script>
</body>
</html>
